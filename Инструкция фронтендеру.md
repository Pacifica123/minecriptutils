# Инструкция для фронтенда — что нужно знать и где ковыряться

Этот документ — краткая, но исчерпывающая инструкция для фронтенд-разработчика, которому передают визуальную часть проекта. Разделение ролей уже сделано: **core** отвечает за данные и бизнес-логику, **visualizer** — за отображение и взаимодействие. Фронтенду трогать нужно только `src/visualizer/` и файлы рядом с выходным HTML.

---

## Быстрый старт (проверка работоспособности)

1. Установить зависимости:

```bash
python -m pip install -r req.txt
```

2. Сгенерировать HTML из примера:

```bash
python -m src.main data/modlist.txt output/modgraph.html --templates src/visualizer/templates --bg-color '#0b0b0b'
```

3. Открыть `output/mods_graph.html` в браузере (Chrome/Chromium рекомендован).

---

## Где работать

Редактировать только:

- `src/visualizer/templates/custom.js` — логика клиентского UI (hotkeys, undo, экспорт/импорт, тулбары).
- `src/visualizer/templates/custom.css` — стили панели и компонентов.
- `src/visualizer/visualizer.py` — только если нужно изменить стратегию инжекции ресурсов в HTML или способ копирования файлов рядом с выходным HTML.

**НЕ ТРОГАТЬ БЕЗ СОГЛАСОВАНИЯ**: `src/core/*` (loader, graph_builder, analyzer) — это ядро проекта.

---

## Контракт данных

Frontend получает граф в виде `network` (vis-network / pyvis). Формат узла/ребра, который гарантирован core:

- Node: `{ id, label, category, size, color, style }`
- Edge: `{ from, to, relation, width, dashes }`

Визуализатор должен работать с этими полями. Если нужен дополнительный атрибут — добавляй, но не полагайся на их наличие в core.

---

## Что можно добавить быстро (короткие примеры)

### Hotkey: выделение + изменение стиля

```javascript
// получить выбранные узлы
const selection = network.getSelectedNodes();
if (selection.length > 0) {
  const id = selection[0];
  network.body.data.nodes.update({id: id, color: {background: '#ff0000'}, size: 50});
}
```

### Экспорт состояния графа в JSON (кнопка "Export")

```javascript
function exportGraph() {
  const nodes = network.body.data.nodes.get();
  const edges = network.body.data.edges.get();
  const data = {nodes: nodes, edges: edges};
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'mods_graph.json'; a.click();
  URL.revokeObjectURL(url);
}
```

### Импорт JSON (кнопка "Import")

```javascript
// file — File object
const reader = new FileReader();
reader.onload = function(e) {
  const json = JSON.parse(e.target.result);
  network.body.data.nodes.clear();
  network.body.data.edges.clear();
  network.body.data.nodes.add(json.nodes);
  network.body.data.edges.add(json.edges);
};
reader.readAsText(file);
```

### Undo (Ctrl+Z) — упрощённый стек снимков

В `custom.js` уже есть простая реализация: делаем снимки при изменениях и откатываемся по Ctrl+Z. Для надёжности:

- сохранять снимок только на значимые события (add/remove node/edge, изменение стиля);
- ограничить глубину стека (например 50);
- добавить Redo (Ctrl+Y) при необходимости.

---

## Панель редактора (минимальный UI)

Пример: панель редактирования цвета/размеров узла. HTML можно добавлять динамически из `custom.js`.

```javascript
const panel = document.createElement('div');
panel.id = 'editorPanel';
panel.innerHTML = `
  <input type="color" id="nodeColor" />
  <input type="range" id="nodeSize" min="8" max="120" />
  <button id="applyStyle">Apply</button>
`;
document.body.appendChild(panel);

document.getElementById('applyStyle').addEventListener('click', () => {
  const sel = network.getSelectedNodes();
  if (!sel.length) return;
  const id = sel[0];
  const color = document.getElementById('nodeColor').value;
  const size = Number(document.getElementById('nodeSize').value);
  network.body.data.nodes.update({id: id, color: {background: color}, size: size});
});
```

Стили панели писать в `custom.css`.

---

## Undo / History — рекомендации для надёжной реализации

- Делать snapshot только при явных изменениях: `addNode`, `removeNode`, `addEdge`, `removeEdge`, `updateStyle`.
- Хранить diff или полноценный снимок (второй проще; хранить не больше N = 50 снимков).
- Для экономии памяти можно хранить только изменения (patch), но это сложнее.
- Поддержать Redo: два стека (undo / redo).

---

## Экспорт в PNG/SVG — быстрые варианты

1. **Headless Chromium / Puppeteer**: запустить скрипт, который откроет HTML и сохранит скриншот.
2. **Canvas toDataURL**: если vis-network рендерит в canvas, вызвать `toDataURL()` и сохранить.

Puppeteer даёт лучший контроль над итоговым изображением и совместим почти со всеми версиями vis.

---

## Что НЕ менять

- `src/core/*` — любые изменения тут могут сломать контракт данных.
- CLI `src/main.py` — только если нужно изменить способ сборки проекта (предварительно согласовать).
- Формат `node`/`edge` — фронтенд может читать дополнительные поля, но core ожидает базовый набор.

---

